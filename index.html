<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>YourPDFPalace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <style>
        .view { display: none; }
        .view.active { display: flex; flex-direction: column; }
        .dashed-border { border: 3px dashed #137fec; border-radius: 16px; }
        .file-card { animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans">

    <header class="bg-slate-900 text-white p-4 shadow-xl">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="window.location.reload()">
                <span class="material-icons text-blue-500">description</span>
                <span class="font-black text-xl tracking-tighter uppercase">YourPDFPalace</span>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-6">
        
        <section id="home-view" class="view active items-center text-center py-12">
            <h1 class="text-6xl font-black text-slate-900 mb-4 uppercase">PDF WORKBENCH</h1>
            <p class="text-slate-500 mb-12 font-medium">No Data Ever Leaves Your Device.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
                <button onclick="initTool('merge')" class="p-10 bg-blue-600 text-white rounded-2xl hover:bg-blue-700 transition-all text-left shadow-lg">
                    <span class="material-icons text-4xl">call_merge</span>
                    <h2 class="text-2xl font-bold mt-2">MERGE PDF</h2>
                </button>
                <button onclick="initTool('split')" class="p-10 bg-blue-600 text-white rounded-2xl hover:bg-blue-700 transition-all text-left shadow-lg">
                    <span class="material-icons text-4xl">call_split</span>
                    <h2 class="text-2xl font-bold mt-2">SPLIT PDF</h2>
                </button>
                <button onclick="initTool('img2pdf')" class="p-10 bg-slate-800 text-white rounded-2xl hover:bg-blue-900 transition-all text-left shadow-lg">
                    <span class="material-icons text-4xl">image</span>
                    <h2 class="text-2xl font-bold mt-2">IMG TO PDF</h2>
                </button>
                <button onclick="initTool('pdf2img')" class="p-10 bg-slate-800 text-white rounded-2xl hover:bg-blue-900 transition-all text-left shadow-lg">
                    <span class="material-icons text-4xl">photo_library</span>
                    <h2 class="text-2xl font-bold mt-2">PDF TO IMG</h2>
                </button>
            </div>
        </section>

        <section id="tool-view" class="view">
            <button onclick="window.location.reload()" class="text-blue-600 font-bold mb-6 flex items-center">
                <span class="material-icons">arrow_back</span> BACK
            </button>
            <h2 id="tool-title" class="text-4xl font-black mb-8 uppercase text-slate-900">TOOL</h2>
            
            <div id="drop-zone" class="dashed-border p-16 text-center cursor-pointer bg-white hover:bg-blue-50 transition-colors">
                <input type="file" id="file-input" class="hidden" multiple>
                <span class="material-icons text-6xl text-blue-600">cloud_upload</span>
                <p class="text-xl font-bold text-slate-700 mt-4">CLICK TO CHOOSE FILES</p>
                <p class="text-slate-400 text-sm italic">Files are processed instantly in memory</p>
            </div>

            <div id="file-list" class="mt-8 space-y-2"></div>

            <div id="split-options" class="hidden mt-8 p-6 bg-white border rounded-xl">
                <label class="block font-bold text-slate-700 mb-2">PAGE RANGE (e.g. 1-2)</label>
                <input id="page-range" type="text" placeholder="1-3" class="w-full p-4 border rounded-lg focus:ring-2 ring-blue-500 outline-none">
            </div>

            <button onclick="runProcess()" class="w-full mt-8 bg-blue-600 text-white font-black py-6 rounded-xl text-xl shadow-xl hover:bg-blue-700 active:scale-95 transition-all">
                EXECUTE ACTION
            </button>
        </section>

        <section id="status-view" class="view items-center justify-center py-24">
            <div id="loader">
                <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-600 mx-auto"></div>
                <h2 class="text-2xl font-bold mt-6">PROCESSING...</h2>
            </div>
            <div id="success" class="hidden text-center w-full">
                <span class="material-icons text-green-500 text-8xl">verified</span>
                <h2 class="text-4xl font-black my-4">FINISHED!</h2>
                <div id="downloads" class="flex flex-col gap-3 max-w-sm mx-auto"></div>
                <button onclick="window.location.reload()" class="mt-12 text-slate-500 font-bold hover:text-blue-600 underline">DO ANOTHER</button>
            </div>
        </section>

    </main>

    <script>
  
        const pdfjs = window['pdfjs-dist/build/pdf'];
        pdfjs.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.min.js`;

        let currentMode = '';
        let files = [];

        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');

       =
        dropZone.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', (e) => {
            files = Array.from(e.target.files);
            renderFileList();
        });

        function renderFileList() {
            const list = document.getElementById('file-list');
            list.innerHTML = files.map(f => `
                <div class="file-card flex items-center bg-white p-4 border rounded-lg shadow-sm">
                    <span class="material-icons text-blue-600 mr-3">description</span>
                    <span class="font-bold truncate">${f.name}</span>
                </div>
            `).join('');
        }

        function initTool(mode) {
            currentMode = mode;
            document.getElementById('tool-title').innerText = mode.replace('2', ' TO ');
            document.getElementById('split-options').style.display = (mode === 'split') ? 'block' : 'none';
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('tool-view').classList.add('active');
        }

        async function runProcess() {
            if (files.length === 0) return alert("Select files first!");
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('status-view').classList.add('active');

            try {
                if (currentMode === 'pdf2img') {
                    await handlePdfToImg(files[0]);
                } else {
                    const bufs = await Promise.all(files.map(f => f.arrayBuffer()));
                    let out;
                    if (currentMode === 'merge') out = await doMerge(bufs);
                    if (currentMode === 'split') out = await doSplit(bufs[0], document.getElementById('page-range').value);
                    if (currentMode === 'img2pdf') out = await doImg2Pdf(bufs);
                    
                    createDownload(new Blob([out], {type:'application/pdf'}), 'result.pdf');
                }
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('success').classList.remove('hidden');
            } catch (err) {
                console.error(err);
                alert("Fatal Error: Check console (F12)");
                window.location.reload();
            }
        }

        async function doMerge(bufs) {
            const doc = await PDFLib.PDFDocument.create();
            for (const b of bufs) {
                const src = await PDFLib.PDFDocument.load(b);
                const pages = await doc.copyPages(src, src.getPageIndices());
                pages.forEach(p => doc.addPage(p));
            }
            return await doc.save();
        }

        async function doSplit(buf, range) {
            const src = await PDFLib.PDFDocument.load(buf);
            const doc = await PDFLib.PDFDocument.create();
            const [s, e] = range.split('-').map(n => parseInt(n) - 1);
            const indices = [];
            for (let i = s; i <= (e || s); i++) if(i < src.getPageCount()) indices.push(i);
            const pages = await doc.copyPages(src, indices);
            pages.forEach(p => doc.addPage(p));
            return await doc.save();
        }

        async function doImg2Pdf(bufs) {
            const doc = await PDFLib.PDFDocument.create();
            for (const b of bufs) {
                const u8 = new Uint8Array(b);
                const isPng = u8[0] === 0x89;
                const img = isPng ? await doc.embedPng(b) : await doc.embedJpg(b);
                const p = doc.addPage([img.width, img.height]);
                p.drawImage(img, { x: 0, y: 0, width: img.width, height: img.height });
            }
            return await doc.save();
        }

        async function handlePdfToImg(file) {
            const data = new Uint8Array(await file.arrayBuffer());
            const loadingTask = pdfjs.getDocument({data});
            const pdf = await loadingTask.promise;
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({scale: 2.0});
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                await page.render({canvasContext: ctx, viewport}).promise;
                canvas.toBlob(b => createDownload(b, `page-${i}.png`), 'image/png');
            }
        }

        function createDownload(blob, name) {
            const url = URL.createObjectURL(blob);
            const btn = document.createElement('button');
            btn.className = "bg-blue-600 text-white font-bold p-4 rounded-xl shadow hover:bg-blue-700 uppercase";
            btn.innerHTML = `Download ${name}`;
            btn.onclick = () => {
                const a = document.createElement('a');
                a.href = url;
                a.download = name;
                a.click();
            };
            document.getElementById('downloads').appendChild(btn);
        }
    </script>
</body>
</html>
